-- 권한 변경 이력 테이블
CREATE TABLE user_role_history (
    history_id      NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, -- 자동 증가 PK
    target_user_id  VARCHAR2(60) NOT NULL,  -- 권한이 변경된 회원
    old_role        VARCHAR2(20),           -- 변경 전 권한
    new_role        VARCHAR2(20),           -- 변경 후 권한
    changed_by      VARCHAR2(60) NOT NULL,  -- 변경을 수행한 관리자
    changed_at      DATE DEFAULT SYSDATE,   -- 변경 일시

    -- 외래키 제약조건 (존재하는 유저만 참조 가능)
    CONSTRAINT fk_user_role_target
        FOREIGN KEY (target_user_id)
        REFERENCES users(user_id)
        ON DELETE CASCADE,

    CONSTRAINT fk_user_role_changed_by
        FOREIGN KEY (changed_by)
        REFERENCES users(user_id)
        ON DELETE SET NULL
);